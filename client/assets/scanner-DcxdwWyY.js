import{w as B}from"./react-router-CYoDxXBS.js";import{r as t,j as e}from"./react-BJrjMfTR.js";import{H}from"./html5-qrcode-sXZgJKei.js";import{i as I,a as b}from"./client-Dn-z3qsN.js";import{B as l}from"./@mui-DMIatDgo.js";import"./react-dom-DxwqsWSf.js";import"./scheduler-Bb8JjhAW.js";import"./hoist-non-react-statics-D6oLcdvU.js";import"./axios-NIGUFBhG.js";import"./jwt-decode-VWaDGczM.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-D3IKUBdq.js";import"./@babel-B4YMtfbM.js";import"./@emotion-BcduERMR.js";import"./stylis-DDa9OTMq.js";import"./react-is-BPJnJB5S.js";function ee({}){return[{title:"Сканер"},{name:"description",content:"Сканер QR-кодов"}]}function P(){const[h,q]=t.useState("Сканируйте код"),[M,u]=t.useState(!1),[w,r]=t.useState(!1),[N,k]=t.useState(null),[x,g]=t.useState(""),[m,p]=t.useState(""),[j,o]=t.useState(""),[c,S]=t.useState(!1),[C,v]=t.useState("");t.useEffect(()=>{(async()=>await I()||(window.location.href="/login"))()},[]);let D=function(s,i){let d=.9,f=Math.min(s,i),n=Math.floor(f*d);return{width:n,height:n}};t.useEffect(()=>{const s={fps:10,qrbox:D,aspectRatio:1},i=new H("qrCodeContainer"),d=()=>{i&&i.isScanning&&i.stop().then(n=>console.log("Scanner stop")).catch(n=>console.log("Scanner error"))},f=(n,E)=>{v(n),o("Отправка кода на сервер..."),b.post("/scan",{text:n,format:E.result.format.format,format_name:E.result.format.formatName},{headers:{"Content-Type":"application/json"}}).then(a=>{o(""),k(a.data.id),q(a.data.data),u(a.data.editable),g(a.data.description||""),p(a.data.description||""),r(!1)}).catch(a=>{o(a.message),u(!1),r(!1)}),S(!1)};return c?(i.start({facingMode:"environment"},s,f,void 0),v("")):d(),()=>{d()}},[c]);const Q=()=>{p(x),r(!0)},y=s=>{p(s.target.value)},R=()=>{o("Сохраняем описание кода..."),b.post("/scan/update-description",{id:N,description:m},{headers:{"Content-Type":"application/json"}}).then(s=>{o(""),g(m),r(!1)}).catch(s=>{o(s.message)})},z=()=>{r(!1)};return e.jsxs("div",{className:"scanner",children:[e.jsx("div",{children:e.jsx(l,{variant:"contained",className:"start-button",onClick:()=>S(!c),children:c?"Выключить":"Включить"})}),e.jsx("div",{id:"qrCodeContainer"}),C&&e.jsx("div",{className:"qr-message",children:C}),j&&e.jsx("div",{className:"qr-error-message",children:j}),w?e.jsxs("div",{className:"edit-form",children:[e.jsx("p",{children:h}),e.jsx("textarea",{value:m,onChange:y,rows:4,cols:50}),e.jsxs("div",{className:"edit-buttons",children:[e.jsx(l,{variant:"contained",onClick:R,children:"Сохранить"}),e.jsx(l,{variant:"contained",onClick:z,children:"Отмена"})]})]}):e.jsxs("div",{className:"result-display",children:[e.jsx("p",{children:h}),e.jsx("p",{children:x}),M&&e.jsx(l,{variant:"contained",onClick:Q,children:"Редактировать описание"})]})]})}const te=B(P);export{te as default,ee as meta};
